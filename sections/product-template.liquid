{% assign current_product = product.selected_or_first_available_variant %} {%
assign product_image = current_product.featured_image | default:
product.featured_image%}

<div class="container">
  <div class="row">
    <div class="col-md-6 col-12">
      <img
        class="img-fluid"
        src="{{ product_image | img_url: 'large' }}"
        alt="{{ product_image.alt }}"
        id="ProductMainImage"
      />
      {% assign imagesArray = '' | split: ',' %} {% for variant in
      product.variants %}
    

      {% assign imageSrc = variant.featured_image.src | split:' _'%} 
      {% assign imagesArray = imagesArray | concat: imageSrc %} 
      {% endfor %} 
      {% for image in imagesArray %}
      <!-- {% assign imageUrl = "cdn.shopify.com/s/files/1/0592/1619/9852/" | append: image  %} -->
      <script>
        console.log('HEREEEE', {{imageUrl|json}});
      </script>

      <img
        src= '{{image | img_url: 'medium'}}'
      />
      {% endfor %}
      <script>
        console.log({{product|json}}, 'IMAGES');
      </script>
    </div>
    <div class="col-md-6 col-12">
      <h1>{{ product.title }}</h1>
      <p>{{ current_product.price | money_without_trailing_zeros }}</p>
      {% form 'product', product, class:"product-form", id:"AddToCartForm" %}
      <div class="mb-3">
        <select name="id" id="productSelect" class="form-select">
          <script>
            console.log({{product.variants|json}}, 'here');
          </script>

          {% for variant in product.variants %} {% if variant.available %}
          <option value="{{ variant.id }}">{{ variant.title }}</option>
          {% else %}
          <option disabled="disabled" value="{{ variant.id }}"></option>

          {% endif %} {% endfor %}
        </select>
        <div class="mb-3">
          <input
            name="quantity"
            id="quantity"
            type="number"
            value="1"
            min="1"
            class="form-control"
          />
        </div>
        <button
          type="submit"
          name="add"
          id="addToCart"
          class="btn rounded-0 btn-secondary btn-lg w-100"
        >
          Aggiungi
        </button>
      </div>
      {% if section.settings.dybamic_button_checkbox %}
      {{ form | payment_button }}

      {% endif %} {% endform %}
    </div>
  </div>
</div>
<div class="container">
  <section id="product_recommendation" class="row content-justify-center my-5">
    <div class="text-center">
      <h1>Ti potrebbe anche piacere</h1>
    </div>
    <div id="product_recommendation_body"></div>
  </section>
</div>
<script>
  const productRecommendationBody = document.getElementById(
    "product_recommendation_body"
  );
  fetch("/recommendations/products.json?product_id={{product.id}}")
    .then((res) => res.json())
    .then(({ products }) => {
      console.log(products);
      if (products.length > 0) {
        products.forEach((prod) => {
          let card;
          card = '<div class="col-3 g-2">';
          card += '<div class="card" style="width: 18rem;">';

          if (product.images.length > 0) {
            card +=
              '<img class="card-img-top" src="' + product.images[0] + '">';
          }
          card += '<div class="card-body">';
          card +=
            '<h3><a href="' + product.url + '">' + product.title + "</a></h3>";
          card += "</div></div></div>";
          productRecommendationBody.innerHTML += card;
        });
      }
    });
</script>
{% schema %}

{
    "name": "Product pages",
    "settings": [
        {
            "type": "checkbox",
            "id": "dynamic_buttons_checkbox",
            "label": "Abilita il bottone dinamico",
            "default": false
        }
    ]
}

{% endschema %}
